---
phase: 02-tier-selection-ux
plan: 04
type: execute
wave: 1
depends_on: []
files_modified: [components/TokenTooltip.vue, components/AnalysisSelector.vue, components/TierComparisonModal.vue]
autonomous: true
requirements: [TIER-02]
gap_closure: true

must_haves:
  truths:
    - "Token tooltips appear individually on hover (not all at once)"
    - "Tooltips are not clipped by table overflow containers"
    - "Tier cards expand independently when clicked"
    - "Comparison table removed (modal provides same info)"
  artifacts:
    - path: "components/TokenTooltip.vue"
      provides: "Individual hover trigger, not group-hover"
      contains: "hover:opacity-100 hover:visible"
    - path: "components/AnalysisSelector.vue"
      provides: "Per-card expanded state tracking"
      contains: "expandedTiers"
    - path: "components/TierComparisonModal.vue"
      provides: "Overflow-visible table container"
      contains: "overflow-visible"
  key_links:
    - from: "components/TokenTooltip.vue"
      to: "hover state"
      via: "individual hover trigger"
      pattern: "hover:opacity-100"
    - from: "components/AnalysisSelector.vue"
      to: "card expansion"
      via: "per-card state object"
      pattern: "expandedTiers\\.value\\[tier\\]"
---

<objective>
Fix UI issues: tooltips triggering together + clipping, and tier cards expanding together.

Purpose: Users reported confusing tooltip behavior (all open at once) and redundant comparison table. Each tooltip should appear individually, and each tier card should expand independently.

Output: Fixed TokenTooltip.vue with individual hover, AnalysisSelector.vue with per-card expansion, and removal of duplicate comparison table.
</objective>

<execution_context>
@/home/cativo23/.claude/get-shit-done/workflows/execute-plan.md
@/home/cativo23/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-tier-selection-ux/02-UAT.md
@.planning/diagnosis/phase2-uat-root-cause-analysis.md
@components/TokenTooltip.vue
@components/AnalysisSelector.vue
@components/TierComparisonModal.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix TokenTooltip to use individual hover instead of group-hover</name>
  <files>components/TokenTooltip.vue</files>
  <action>
    Fix the tooltip triggering issue in components/TokenTooltip.vue:

    Line 2 - Remove group class:
    - FROM: <div class="relative group inline-block">
    - TO: <div class="relative inline-block">

    Line 10 - Change group-hover to hover:
    - FROM: group-hover:opacity-100 group-hover:visible
    - TO: hover:opacity-100 hover:visible

    Full line 10 should read:
    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-4 py-3 bg-slate-900 dark:bg-white text-white dark:text-slate-900 text-sm rounded-xl opacity-0 invisible hover:opacity-100 hover:visible transition-all duration-200 w-72 shadow-xl z-50"

    This ensures each tooltip responds only to its own hover state, not a parent group's hover.
  </action>
  <verify>
    1. Grep TokenTooltip.vue for "group" - should NOT find "group" class
    2. Grep TokenTooltip.vue for "hover:opacity-100 hover:visible" - should find it on line 10
    3. npm run dev - hover over individual tooltips - only the hovered tooltip should appear
  </verify>
  <done>TokenTooltip.vue uses individual hover trigger (hover:opacity-100 hover:visible) instead of group-hover, tooltips appear one at a time</done>
</task>

<task type="auto">
  <name>Task 2: Fix tooltip clipping in TierComparisonModal table</name>
  <files>components/TierComparisonModal.vue</files>
  <action>
    Fix tooltip clipping in components/TierComparisonModal.vue:

    Line 31 - Add overflow-visible to table container:
    - FROM: <div class="overflow-x-auto mb-8">
    - TO: <div class="overflow-visible mb-8">

    This prevents the table container from clipping the tooltips that position themselves with bottom-full.

    Also verify TokenTooltip in this modal uses the fixed individual hover (Task 1 fixes the component globally).
  </action>
  <verify>
    1. Grep TierComparisonModal.vue line 31 - should find "overflow-visible"
    2. npm run dev - open comparison modal - hover over token limits in table - tooltips should appear above without clipping
  </verify>
  <done>TierComparisonModal.vue table container uses overflow-visible, tooltips are not clipped</done>
</task>

<task type="auto">
  <name>Task 3: Fix tier cards to expand independently with per-card state</name>
  <files>components/AnalysisSelector.vue</files>
  <action>
    Fix the card expansion logic in components/AnalysisSelector.vue:

    Lines 494-507 - Replace single isExpanded with per-card state:

    REPLACE:
    const isExpanded = ref<"basic" | "premium" | "forensic" | null>(null);

    const toggleExpand = (tier: "basic" | "premium" | "forensic") => {
      isExpanded.value = isExpanded.value === tier ? null : tier;
      // Also select the tier when clicked (if credits available)
      if (
        tier === "basic" ||
        (tier === "premium" && hasCreditsForPremium.value) ||
        (tier === "forensic" && hasCreditsForForensic.value)
      ) {
        emit("update:modelValue", tier);
      }
    };

    WITH:
    const expandedTiers = ref({
      basic: false,
      premium: false,
      forensic: false,
    });

    const toggleExpand = (tier: "basic" | "premium" | "forensic") => {
      expandedTiers.value[tier] = !expandedTiers.value[tier];
      // Also select the tier when clicked (if credits available)
      if (
        tier === "basic" ||
        (tier === "premium" && hasCreditsForPremium.value) ||
        (tier === "forensic" && hasCreditsForForensic.value)
      ) {
        emit("update:modelValue", tier);
      }
    };

    Update template conditions (lines 7, 35, 121, 165, 252, 296):
    - FROM: isExpanded === 'basic'
    - TO: expandedTiers.basic

    - FROM: v-if="!isExpanded"
    - TO: v-if="!expandedTiers.basic" (for Basic card)
    - TO: v-if="!expandedTiers.premium" (for Premium card)
    - TO: v-if="!expandedTiers.forensic" (for Forensic card)

    Update v-else blocks similarly to check their respective tier state.
  </action>
  <verify>
    1. Grep AnalysisSelector.vue for "expandedTiers" - should find the ref and its usage
    2. Grep AnalysisSelector.vue for "isExpanded" - should NOT find it (replaced)
    3. npm run dev - click each card - each should expand independently without affecting others
  </verify>
  <done>AnalysisSelector.vue tracks expanded state per-card using expandedTiers object, each card expands/collapses independently</done>
</task>

<task type="auto">
  <name>Task 4: Remove duplicate comparison table from AnalysisSelector</name>
  <files>components/AnalysisSelector.vue</files>
  <action>
    Remove the duplicate "Comparativa de Niveles" table from components/AnalysisSelector.vue:

    Remove lines 388-468 (the entire "Tier Comparison Table" section):
    - The div with class "mt-8 p-6 bg-slate-50..." (line 389)
    - The h4 header "Comparativa de Niveles" (lines 392-396)
    - The grid with 3 columns showing Basic/Premium/Forensic (lines 397-457)
    - The "Cuál nivel es para mí?" button (lines 459-467)

    Keep the TierComparisonModal component (line 471) - it provides the same information with better UX.

    After removal, the file should end at line 387 (closing </div> of tier cards) followed by the modal at line 471.
  </action>
  <verify>
    1. Grep AnalysisSelector.vue for "Comparativa de Niveles" - should NOT find it
    2. Grep AnalysisSelector.vue for "TierComparisonModal" - should still find it (modal kept)
    3. npm run dev - verify only the "Cuál nivel es para mí?" button appears, opens modal with full comparison
  </verify>
  <done>Duplicate comparison table removed from AnalysisSelector.vue, only TierComparisonModal remains for tier comparison</done>
</task>

</tasks>

<verification>
  1. npm run dev and navigate to /dashboard
  2. Hover over token tooltips in tier cards - only one tooltip should appear at a time
  3. Click "Cuál nivel es para mí?" - modal opens
  4. Hover over token tooltips in modal table - tooltips should appear above without clipping
  5. Click each tier card - each should expand independently without affecting others
  6. Verify "Comparativa de Niveles" table is removed from the page
</verification>

<success_criteria>
  - [ ] TokenTooltip.vue uses hover:opacity-100 hover:visible (not group-hover)
  - [ ] TierComparisonModal.vue table uses overflow-visible (not overflow-x-auto)
  - [ ] AnalysisSelector.vue uses expandedTiers object for per-card state
  - [ ] Each tier card expands/collapses independently
  - [ ] Duplicate comparison table removed (lines 388-468)
  - [ ] Tooltips appear individually on hover (not all at once)
  - [ ] Tooltips are not clipped by table boundaries
</success_criteria>

<output>
After completion, create .planning/phases/02-tier-selection-ux/02-04-SUMMARY.md
</output>
