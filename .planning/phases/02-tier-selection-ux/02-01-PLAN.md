---
phase: 02-tier-selection-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [components/AnalysisSelector.vue, components/TierComparisonModal.vue, components/TokenTooltip.vue]
autonomous: true
requirements: [TIER-02]

must_haves:
  truths:
    - "User sees Basic/Premium/Forensic tier cards with credit costs"
    - "User can open comparison modal with feature matrix and use cases"
    - "Token limits display with tooltip explaining tokens in non-technical terms"
    - "Premium tier displays subtle 'Recomendado' badge"
  artifacts:
    - path: "components/AnalysisSelector.vue"
      provides: "Tier selection cards with expand-on-click and credit validation"
      min_lines: 200
    - path: "components/TierComparisonModal.vue"
      provides: "Comparison modal with feature matrix and use cases"
      min_lines: 150
    - path: "components/TokenTooltip.vue"
      provides: "Reusable tooltip explaining tokens (~4 chars, 8K = 2-3 pages)"
      min_lines: 40
  key_links:
    - from: "components/AnalysisSelector.vue"
      to: "components/TierComparisonModal.vue"
      via: "component import and modal trigger"
      pattern: "TierComparisonModal.*v-model"
    - from: "components/AnalysisSelector.vue"
      to: "components/TokenTooltip.vue"
      via: "component import for token limit display"
      pattern: "TokenTooltip"
---

<objective>
Enhance tier selection UX with comparison modal, token education, and expand-on-click cards.

Purpose: Users need to understand the difference between Basic/Premium/Forensic tiers and make informed decisions. The existing AnalysisSelector has basic cards but lacks detailed comparison, token education, and progressive disclosure.

Output: Enhanced AnalysisSelector.vue with comparison modal button, new TierComparisonModal.vue component, and new TokenTooltip.vue component.
</objective>

<execution_context>
@/home/cativo23/.claude/get-shit-done/workflows/execute-plan.md
@/home/cativo23/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-tier-selection-ux/02-CONTEXT.md
@.planning/phases/02-tier-selection-ux/02-RESEARCH.md
@components/AnalysisSelector.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TokenTooltip component for non-technical token explanation</name>
  <files>components/TokenTooltip.vue</files>
  <action>
    Create a reusable tooltip component that explains tokens in user-friendly terms:
    - Use CSS-only hover tooltip (no Popper.js needed for this simple use case)
    - Position: absolute above the trigger element with arrow pointer
    - Content slot for flexible content
    - Include default explanation: "Piensa en tokens como ~4 caracteres cada uno. 8K tokens ≈ 2-3 páginas de contrato"
    - Styling: slate-900 background (white in dark mode), rounded-xl, shadow-xl, w-72
    - Transition: opacity-0/100 and invisible/visible on group-hover
    - Support dark mode with appropriate color swaps
  </action>
  <verify>Component exists at /home/cativo23/projects/personal/clarify/components/TokenTooltip.vue with proper template, script setup, and dark mode support</verify>
  <done>TokenTooltip.vue created with hover-triggered tooltip displaying token explanation in both light and dark modes</done>
</task>

<task type="auto">
  <name>Task 2: Create TierComparisonModal with feature matrix and use cases</name>
  <files>components/TierComparisonModal.vue</files>
  <action>
    Create a modal component for detailed tier comparison:
    - Use Teleport to body for proper z-index stacking
    - Use Vue Transition for fade-in/scale animation (named "modal")
    - Backdrop: bg-black/50 with backdrop-blur-sm, closes modal on click
    - Modal content: max-w-4xl, max-h-[90vh], overflow-y-auto, rounded-3xl
    - Close button: X icon in top-right corner

    Feature comparison table:
    - Columns: Feature name, Basic (1 crédito), Premium (3 créditos), Forensic (10 créditos)
    - Rows: token limits, coverage percentage, analysis speed, best for use case
    - Use checkmarks (✓) for included features
    - Highlight Premium column with bg-secondary/5 border-secondary/20

    Use cases section below table:
    - 3 columns: "Mejor para Básico", "Mejor para Premium", "Mejor para Forensic"
    - Premium use case card highlighted with bg-secondary/5 border-secondary/20
    - Content from CONTEXT.md: Basic for rapid scans, Premium for standard contracts, Forensic for high-value

    Props: isOpen (v-model), close method via emits
  </action>
  <verify>Component exists at /home/cativo23/projects/personal/clarify/components/TierComparisonModal.vue with Teleport, Transition, feature table, and use cases</verify>
  <done>TierComparisonModal.vue created with accessible modal structure, feature comparison table, and tier use cases</done>
</task>

<task type="auto">
  <name>Task 3: Enhance AnalysisSelector with modal trigger and token tooltips</name>
  <files>components/AnalysisSelector.vue</files>
  <action>
    Enhance the existing AnalysisSelector.vue component:

    1. Add comparison modal:
       - Import TierComparisonModal component
       - Add isComparisonModalOpen ref(false) state
       - Add "¿Cuál nivel es para mí?" button/trigger below tier cards
       - Button styling: text-xs font-black uppercase tracking-widest text-secondary hover:underline
       - Wire button click to open modal (isComparisonModalOpen = true)
       - Add modal component with v-model="isComparisonModalOpen"

    2. Add token tooltips to tier comparison table:
       - Import TokenTooltip component
       - Replace "~8K tokens" text with TokenTooltip wrapper
       - Replace "~35K tokens" text with TokenTooltip wrapper
       - Replace "~120K tokens" text with TokenTooltip wrapper
       - Each tooltip shows tier-specific explanation

    3. Make tier cards expand-on-click (per CONTEXT.md):
       - Add isExpanded ref(null | 'basic' | 'premium' | 'forensic')
       - On card click: isExpanded.value = isExpanded.value === tier ? null : tier
       - Compact view (v-if="!isExpanded"): Show name, one-liner, 2-3 features
       - Expanded view (v-else): Show all features, token limit, detailed description
       - Add transition-all duration-300 for smooth expansion
       - Add ring-4 ring-secondary/10 when expanded for visual feedback

    4. Keep existing credit validation logic (hasCreditsForPremium, hasCreditsForForensic)
  </action>
  <verify>
    1. Grep for "TierComparisonModal" in AnalysisSelector.vue
    2. Grep for "TokenTooltip" in AnalysisSelector.vue
    3. Grep for "isExpanded" in AnalysisSelector.vue
    4. Visually verify in browser: cards expand on click, modal opens, tooltips show on hover
  </verify>
  <done>AnalysisSelector.vue enhanced with expandable cards, comparison modal trigger, and token tooltips - user can select tier, see detailed comparison, and understand token limits</done>
</task>

</tasks>

<verification>
  1. Run npm run dev and navigate to /dashboard
  2. Click "¿Cuál nivel es para mí?" button - modal should open with feature comparison table
  3. Hover over token limits (~8K, ~35K, ~120K) - tooltips should appear with explanations
  4. Click on tier cards - they should expand to show more details
  5. Verify Premium tier displays "Recomendado" badge (subtle, not prominent)
  6. Verify credit validation still works (insufficient credits = disabled card)
</verification>

<success_criteria>
  - [ ] TierComparisonModal.vue exists with feature matrix and use cases
  - [ ] TokenTooltip.vue exists with non-technical token explanation
  - [ ] AnalysisSelector.vue cards expand on click to reveal more details
  - [ ] Comparison modal opens from "¿Cuál nivel es para mí?" button
  - [ ] Token tooltips appear on hover for all three tiers
  - [ ] Premium badge is subtle ("Recomendado" text, not prominent highlight)
  - [ ] Credit validation still prevents selection when insufficient credits
  - [ ] All components support dark mode
</success_criteria>

<output>
After completion, create .planning/phases/02-tier-selection-ux/02-01-SUMMARY.md
</output>
