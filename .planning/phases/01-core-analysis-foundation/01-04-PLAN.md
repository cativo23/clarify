---
phase: 01-core-analysis-foundation
plan: 04
type: gap_closure
wave: 1
depends_on: []
files_modified: [pages/analyze/[id].vue]
autonomous: true
gap_closure: true
requirements: [TIER-03]

must_haves:
  truths:
    - "Forensic analysis results page displays analisis_cruzado section"
    - "Forensic analysis results page displays omisiones_critic with suggested clauses"
    - "Forensic analysis results page displays mapa_estructural"
    - "Forensic-specific sections are visually differentiated from basic findings"
  artifacts:
    - path: "pages/analyze/[id].vue"
      provides: "UI components to display Forensic-specific analysis sections"
      min_lines: 100
  key_links:
    - from: "pages/analyze/[id].vue"
      to: "analysis.summary_json.analisis_cruzado"
      via: "v-for rendering of cross-clause analysis"
      pattern: "analisis_cruzado"
    - from: "pages/analyze/[id].vue"
      to: "analysis.summary_json.omisiones_critic"
      via: "v-for rendering with suggested clause templates"
      pattern: "omisiones_critic"
---

<objective>
Add UI components to display Forensic-specific analysis sections that already exist in the backend data.

Purpose: Phase 1 UAT Test 4 identified that Forensic tier produces unique data sections (analisis_cruzado, omisiones_critic, mapa_estructural) but the results page doesn't display them. The backend already generates this data - it just needs UI components to render it.

Output: Enhanced analysis results page with Forensic-specific sections visible only when data exists.
</objective>

<execution_context>
@/home/cativo23/.claude/get-shit-done/workflows/execute-plan.md
@/home/cativo23/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
**UAT Gap Source:** `.planning/phases/01-core-analysis-foundation/01-UAT.md` - Test 4 PARTIAL PASS

**From UAT:**
> Gap identified: The analysis results page doesn't render `analisis_cruzado`, `omisiones_critic`, and `mapa_estructural` sections. Data is present in `summary_json` but UI components don't display them.

**Backend Data Structure (already exists):**
- `analisis_cruzado`: Array of cross-clause inconsistencies
- `omisiones_critic`: Array of critical omissions with suggested_clause templates
- `mapa_estructural`: Object with paragraph counts per section
</context>

<tasks>

## Task 1: Analyze existing data structure

Read the backend output structure to understand the exact format of Forensic-specific fields.

**Files to read:**
- `pages/analyze/[id].vue` - Current results page structure
- `server/api/analyses/[id].get.ts` or similar - API response structure
- Any test fixtures or sample analysis JSON with Forensic data

**Deliverable:**
Document the exact TypeScript interface for:
- `AnalisisCruzado`
- `OmisionCritic`
- `MapaEstructural`

---

## Task 2: Create Forensic-specific UI components

Create reusable Vue components for each Forensic section.

**Components to create:**
1. `components/analysis/CrossClauseAnalysis.vue` - Displays analisis_cruzado array
2. `components/analysis/CriticalOmissions.vue` - Displays omisiones_critic with suggested clauses
3. `components/analysis/StructuralMap.vue` - Displays mapa_estructural

**Design requirements:**
- Each component should be visually distinct (different background/border)
- Use Forensic tier branding (ShieldCheckIcon, gradient from secondary to accent-indigo)
- Collapsible sections with chevron icons
- Empty state handling (show nothing if data doesn't exist)

**Example structure for CrossClauseAnalysis.vue:**
```vue
<template>
  <section class="forensic-section border-2 border-accent-indigo/30 rounded-2xl p-6">
    <div class="flex items-center gap-3 mb-4">
      <ShieldCheckIcon class="w-6 h-6 text-accent-indigo" />
      <h3 class="text-lg font-black text-slate-900">Análisis Cruzado de Cláusulas</h3>
    </div>
    <div class="space-y-4">
      <div v-for="(item, idx) in analisisCruzado" :key="idx"
           class="bg-slate-50 dark:bg-slate-800 rounded-xl p-4 border-l-4 border-risk-high">
        <p class="font-bold text-slate-700 dark:text-slate-300">{{ item.inconsistency }}</p>
        <p class="text-sm text-slate-500 mt-2">{{ item.explanation }}</p>
      </div>
    </div>
  </section>
</template>
```

---

## Task 3: Integrate components into analysis results page

**File to modify:** `pages/analyze/[id].vue`

**Integration steps:**
1. Import new components
2. Add conditional rendering (only show if Forensic tier AND data exists)
3. Position sections logically in the results flow:
   - After basic findings (hallazgos)
   - Before debug section (if visible)

**Example integration:**
```vue
<!-- Existing findings section -->
<FindingsList :findings="analysis.summary_json.hallazgos" />

<!-- NEW: Forensic-specific sections -->
<CrossClauseAnalysis
  v-if="isForensic && analysis.summary_json.analisis_cruzado?.length"
  :analisis-cruzado="analysis.summary_json.analisis_cruzado"
/>

<CriticalOmissions
  v-if="isForensic && analysis.summary_json.omisiones_critic?.length"
  :omisiones="analysis.summary_json.omisiones_critic"
/>

<StructuralMap
  v-if="isForensic && analysis.summary_json.mapa_estructural"
  :mapa="analysis.summary_json.mapa_estructural"
/>
```

**Computed property to add:**
```typescript
const isForensic = computed(() => analysis.value.analysis_type === 'forensic')
```

---

</tasks>

<success_criteria>
- [ ] CrossClauseAnalysis.vue component created and displays analisis_cruzado array
- [ ] CriticalOmissions.vue component created with suggested clause display
- [ ] StructuralMap.vue component created showing paragraph counts
- [ ] All components only render for Forensic tier analyses
- [ ] Components handle empty/missing data gracefully (no errors)
- [ ] Visual design matches Forensic branding (indigo/purple accents)
- [ ] Components are collapsible for better information hierarchy
- [ ] Dark mode supported
</success_criteria>

<verification>
**Manual testing:**
1. Open a Forensic analysis results page
2. Verify "Análisis Cruzado de Cláusulas" section appears with data
3. Verify "Omisiones Críticas" section shows suggested clause templates
4. Verify "Mapa Estructural" section shows paragraph counts per section
5. Open a Premium analysis - verify Forensic sections do NOT appear
6. Test dark mode - verify all sections render correctly
</verification>

---

*Plan 01-04: Gap closure for Phase 1 UAT Test 4*
