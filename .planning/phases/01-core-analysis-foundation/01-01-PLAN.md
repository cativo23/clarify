---
phase: 01-core-analysis-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - server/prompts/v2/forensic-analysis-prompt.txt
autonomous: true
requirements:
  - PROMPT-01

must_haves:
  truths:
    - "Forensic prompt file exists in /server/prompts/v2/"
    - "Prompt specifies 100% clause coverage requirement"
    - "Prompt includes cross-clause consistency analysis"
    - "Prompt requires exhaustive omissions detection"
    - "Output target is 15k-40k tokens"
  artifacts:
    - path: "server/prompts/v2/forensic-analysis-prompt.txt"
      provides: "Forensic analysis system prompt"
      min_lines: 200
  key_links:
    - from: "server/utils/openai-client.ts"
      to: "server/prompts/v2/forensic-analysis-prompt.txt"
      via: "prompt file resolution"
      pattern: "forensic-analysis-prompt\\.txt"
---

<objective>
Create the Forensic Analysis prompt file with 100% coverage requirements, cross-clause analysis, and exhaustive detection capabilities.

Purpose: The Forensic tier needs a dedicated prompt that differs from Premium by requiring complete clause-by-clause analysis, detecting inconsistencies between clauses, and listing all critical omissions.

Output: A complete forensic-analysis-prompt.txt file in /server/prompts/v2/ that instructs the AI to perform exhaustive analysis with 100% coverage.
</objective>

<execution_context>
@/home/cativo23/.claude/get-shit-done/workflows/execute-plan.md
@/home/cativo23/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-analysis-foundation/01-CONTEXT.md
@.planning/phases/01-core-analysis-foundation/01-RESEARCH.md
@server/prompts/v2/analysis-prompt.txt
@server/prompts/v2/basic-analysis-prompt.txt
</context>

<tasks>

<task type="auto">
  <name>Create Forensic Analysis Prompt File</name>
  <files>server/prompts/v2/forensic-analysis-prompt.txt</files>
  <action>
    Create a comprehensive Forensic Analysis prompt file that includes:

    1. **Legal Disclaimer**: Same as Premium/Basic - informational only, not legal advice

    2. **System Identity**: Elite Forensic Contract Auditor with 25 years experience, powered by GPT-5, specializing in 100% exhaustive coverage

    3. **Key Differences from Premium**:
       - Coverage: 100% (vs Premium's 95%)
       - Cross-clause analysis: Detect inconsistencies between related clauses
       - Exhaustive omissions: List ALL critical missing clauses
       - Output target: 15k-40k tokens (vs Premium's 6k-10k)
       - Detection: Everything extra that Premium might skip

    4. **Analysis Algorithm**:
       - Phase 1: Complete structural mapping of ALL sections
       - Phase 2: Clause-by-clause extraction (nothing skipped)
       - Phase 3: Cross-clause consistency checking (if Clause A references Clause B, analyze both together)
       - Phase 4: Exhaustive omissions detection (list every critical clause type that's missing)
       - Phase 5: Classification by severity (ROJO/AMARILLO/VERDE/GRIS)

    5. **Coverage Requirements**:
       - Every paragraph must be analyzed
       - Every clause must be classified
       - Cross-references must be followed and analyzed together
       - Missing critical clauses must be identified with impact analysis

    6. **Response Format**: Extended JSON structure including:
       - _debug with token usage, model info
       - resumen_ejecutivo with clear verdict
       - nivel_riesgo_general
       - metricas with counts per severity
       - hallazgos array (all findings, ordered by severity: rojas first, then amarillas, verdes, grises)
       - analisis_cruzado: array of cross-clause inconsistencies detected
       - omisiones_critic: exhaustive list of missing critical clauses
       - clausulas_no_clasificadas with reason

    7. **Token Management**:
       - Input: Up to 120k tokens (full gpt-5 context)
       - Output target: 15k-40k tokens
       - For contracts exceeding 120k: implement smart chunking strategy with overlap

    8. **Quality Checklist**: Similar to Premium but with 100% coverage verification

    Use the Premium prompt (/server/prompts/v2/analysis-prompt.txt) as a structural template but extend significantly for exhaustive coverage.
  </action>
  <verify>
    - File exists at /home/cativo23/projects/personal/clarify/server/prompts/v2/forensic-analysis-prompt.txt
    - File contains "100%" coverage requirement
    - File contains cross-clause analysis instructions
    - File contains exhaustive omissions detection
    - File specifies 15k-40k token output target
    - File is at least 200 lines
  </verify>
  <done>
    Forensic analysis prompt file created with all required sections for 100% coverage analysis.
  </done>
</task>

</tasks>

<verification>
- Forensic prompt file exists and is syntactically valid
- Prompt clearly differentiates from Premium (100% vs 95% coverage)
- Prompt includes cross-clause analysis algorithm
- Prompt includes exhaustive omissions detection
- Prompt specifies appropriate token budgets (15k-40k output)
</verification>

<success_criteria>
- server/prompts/v2/forensic-analysis-prompt.txt exists with 200+ lines
- Prompt can be loaded by openai-client.ts without errors
- Prompt instructions clearly support 100% coverage requirement
</success_criteria>

<output>
After completion, create .planning/phases/01-core-analysis-foundation/01-01-SUMMARY.md
</output>
